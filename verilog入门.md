# verilog入门

## 1.verilog模块结构

| **模块部分**                          | **内容**                     |
| ------------------------------------- | ---------------------------- |
| **module 模块名 ([端口列表]);**       |                              |
| [端口信号声明:]                       |                              |
| [参数声明:]                           |                              |
| **内部信号声明**                      | **assign语句**               |
| **底层模块或门原语调用 (包括生成块)** | **Initial 或 always 语句块** |
| **任务和函数定义**                    | **specify 块 (路径延迟)**    |
| **endmodule**                         |                              |

常见语句主要有以下三种：

- `assign` 语句
- `always` 语句
- 底层模块调用语句

**语句顺序**：

- 三种语句的顺序无关，彼此独立。

**模块结构必备部分**：

- 除开头的 `module` 模块名和结尾的 `endmodule` 是必须的外，其它部分都是可选的。

### 例一.二选一数据选择器

#### 1.**二选一数据选择器的描述**

- 功能：
  - 选择两个输入信号中的一个作为输出。
  - 根据选择信号 `s` 的状态选择输入 `a` 或 `b`。

#### **2. 二选一数据选择器的符号**

- **输入端**：
  - `a` 和 `b`：数据输入信号。
  - `s`：选择信号。
- **输出端**：
  - `y`：输出信号。
- **功能描述**：
  - 当选择信号 `s=0` 时，输出 `y=a`。
  - 当选择信号 `s=1` 时，输出 `y=b`。

二选一数据选择器的符号

```text
        s
        |
        |
   +----|----+
   |         |
   |    MUX  |
   |         |
   +----+----+
        |
        y
    ----|----
        |
   +----+----+
   |         |
 a |         | b
```

#### 3.**二选一数据选择器的结构之一**

- 逻辑电路结构：
  - 包括：
    - 一个 **NOT 门**：对选择信号 `s` 进行反相。
    - 两个 **AND 门**：分别与输入信号 `a` 和 `b` 配合。
    - 一个 **OR 门**：汇总 AND 门的输出，得到最终的 `y`。
  - 工作原理：
    - 当 `s=0`，NOT 门输出高电平，使得 `y=a`。
    - 当 `s=1`，直接使 `y=b`。

```text
   a -----------+-----[AND]---+
                 |             |
                 |             +---[OR]--- y
                 |             |
   b ----[AND]---+             |
                              [NOT]
                                |
                                s
```

#### 4.二选一多路选择器的verilog描述

```verilog
module MUX21a (a, b, s, y);
    input a, b, s;
    output y;

    assign y = (s ? a : b);
endmodule
```

**代码解析：**

1. **模块名称**：

   - `MUX21a`：表示一个二选一多路选择器模块。

2. **端口列表**：

   - 输入信号：
     - `a` 和 `b`：选择器的两个数据输入。
     - `s`：控制选择信号。
   - 输出信号：
     - `y`：选择的输出信号。

3. **逻辑功能**：

   - 使用三元运算符 

     ```
     s ? a : b
     ```

      实现数据选择：

     - 当 `s = 1` 时，`y = a`。
     - 当 `s = 0` 时，`y = b`。

### 例二.边沿D触发器

#### 1.电路描述

```text
       +---------+
CLK -->|         |
       |   DFF   |--> Q
 D  -->|         |
       +---------+
```

**电路图描述（文字形式）**

1. **输入信号**：
   - `D`：数据输入。
   - `CLK`：时钟输入，触发数据更新。
2. **内部逻辑**：
   - 一个 D 触发器，根据 `CLK` 的上升沿触发，存储并输出数据 `D`。
3. **输出信号**：
   - `Q`：存储的输出值。

#### 2.代码

```verilog
module DFF1 (CLK, D, Q);
    output Q;
    input CLK, D;
    reg Q;

    always @(posedge CLK) 
        Q <= D;
endmodule
```

**代码解析**

1. **模块名称**：
   - `DFF1` 表示一个边沿触发的 D 触发器。
2. **端口声明**：
   - `CLK`：时钟信号输入，用于触发数据更新。
   - `D`：数据输入。
   - `Q`：数据输出。
3. **信号类型**：
   - `Q` 被声明为 `reg` 类型，因为在 `always` 块中进行赋值。
4. **逻辑描述**：
   - 在 `always` 块中，使用 `@(posedge CLK)` 指定上升沿触发。
   - `Q <= D` 表示非阻塞赋值，更新触发器的输出为输入数据 `D`。

## 2.模块说明部分

#### 模块声明格式：

```verilog
module 模块名 ([端口列表]);
    [端口信号声明:]
    [参数声明:]
endmodule
```

- **输入输出属性 数据类型 位宽 名称**
  输入信号属性包括 `input`，输出信号属性包括 `output`，可选信号类型为 `wire` 或 `reg`。
- **parameter 数据类型 参数名 = 初值**
  参数声明可以通过 `parameter` 定义参数名称、数据类型和初始值。

------

#### **模块说明内容：**

1. **模块名**
   - 模块名是指电路的名字，由用户指定，最好与文件名一致（特别是在 Quartus II 软件中调试时）。
2. **端口列表**
   - 指电路的输入/输出信号名称列表，信号名由用户指定，各名称间用逗号隔开。
3. **端口信号声明**
   - 说明端口信号的输入输出属性、信号的数据类型，以及信号的位宽：
     - 输入输出属性有 `input`、`output`、`inout` 三种。
     - 信号的数据类型常用的有 `wire` 和 `reg` 两种。
     - 信号的位宽用 `[n1:n2]` 表示，同一类信号之间用逗号隔开。
4. **参数声明**
   - 参数声明要说明参数的名称和初值。

#### 例

```verilog
module full_adder (A, B, CIN, S, COUT);
    input [3:0] A, B;
    input CIN;
    output reg [3:0] S;
    output COUT;
endmodule
```

#### 关键知识点

1. **位宽默认值**：
   - 如果位宽没有做说明，默认是 **1 位**。
2. **数据类型默认值**：
   - 如果数据类型没有做说明，默认是 **`wire` 型**。
3. **信号位宽**：
   - 信号 `S` 的位宽为 4 位，对应信号为 `S[3]`、`S[2]`、`S[1]` 和 `S[0]`。

## 3.assign语句

#### **`assign` 语句称作连续赋值语句**

##### **基本格式**

```verilog
assign 赋值目标 = 表达式;
```

------

##### **示例代码**

```verilog
assign y = a;
assign y = a & b;
```

- 图示解释：
  - `assign y = a;`：直接将信号 `a` 赋值给 `y`。
  - `assign y = a & b;`：将信号 `a` 和 `b` 的按位与操作结果赋值给 `y`。

------

##### **特点**

1. **连续赋值语句**：
   - 是指赋值总是处于激活状态，只要表达式中的操作数有变化，立即进行计算和赋值。
   - 与 `always` 块中的过程赋值语句不同，`assign` 是针对 **组合逻辑** 的描述。
2. **赋值目标**：
   - 必须是 `wire` 类型的变量。
   - `wire` 表示电路的连接线，不能用 `reg` 类型作为目标。

#### 可用于assign语句的表达式

##### 表 1: Verilog 运算符和操作功能

| **操作类型** | **操作符** | **执行的操作** |
| ------------ | ---------- | -------------- |
| 算术         | `*`        | 乘             |
|              | `/`        | 除             |
|              | `+`        | 加             |
|              | `-`        | 减             |
|              | `%`        | 取模           |
|              | `**`       | 求幂           |
| 逻辑         | `!`        | 逻辑求反       |
|              | `&&`       | 逻辑与         |
|              | `||`       | 逻辑或         |
| 关系         | `>`        | 大于           |
|              | `<`        | 小于           |
|              | `>=`       | 大于等于       |
|              | `<=`       | 小于等于       |
| 等价         | `==`       | 相等           |
|              | `!=`       | 不等           |
|              | `===`      | case 相等      |
|              | `!==`      | case 不等      |

##### 表 2: Verilog 其他运算功能

| **操作类型** | **操作符**  | **执行的操作** |
| ------------ | ----------- | -------------- |
| 按位         | `~`         | 按位求反       |
|              | `&`         | 按位与         |
|              | `|`         | 按位或         |
|              | `^`         | 按位异或       |
|              | `^~` / `~^` | 按位同或       |
| 缩减         | `&`         | 缩减与         |
|              | `~&`        | 缩减与非       |
|              | `|`         | 缩减或         |
|              | `~|`        | 缩减或非       |
|              | `^`         | 缩减异或       |
|              | `^~` / `~^` | 缩减同或       |
| 移位         | `>>`        | 右移           |
|              | `<<`        | 左移           |
|              | `>>>`       | 算术右移       |
|              | `<<<`       | 算术左移       |
| 拼接         | `{}`        | 拼接           |
| 复制         | `{{}}`      | 复制           |
| 条件         | `?:`        | 条件           |

#### 说明：

1.算术型

加减乘除、求幂的操作数可以是实数也可以是整数，求余运算的操作数只能是整数。

求余运算结果取第一个操作数的符号。

2.逻辑型

**逻辑型运算的结果**可能是：

- `1`（逻辑真）、
- `0`（逻辑假）、
- `x`（不确定）。

**逻辑运算的操作数**可以是任意表达式，表达式的结果被当做逻辑值处理，只有 `1`、`0`、`x` 三种情况：

- 非 `0` 的值即为 `1`；
- `0` 表示逻辑假；
- `x` 表示不确定。

**建议**：表达式最好加括号。

3.关系运算符

关系运算符的结果可能是1，0，x

4.等价运算符

**等于和不等于运算的结果**可能是：

- `1`（逻辑真）、
- `0`（逻辑假）、
- `x`（不确定）。
- 对于 `x` 或 `z`，认为是不确定的值，比较结果为 `x`。

**case 等于和 case 不等的结果**只能是：

- `1` 或 `0`，
- 对于 `x`、`z` 认为是确定的值，参与比较。

5.按位运算符

**按位运算的操作数**是 1 位或多位二进制数。

**按位非的操作数**只有一个，将该数的每一位求非运算。

**其它按位运算的操作数**有 2 个或多个，将两个操作数对应的位两两运算。

如果操作数位宽不同，位宽小的会自动左添 0 补齐。

**结果与操作数位宽相同**。

6.缩减运算符

**缩减运算的操作数**是 1 位或多位二进制数。

**缩减运算的操作数**只有一个，将该数的各位自左至右进行逻辑运算，结果只有一位。

7.移位运算符

格式：操作数 移位符 n;

**移位运算的操作数**是 1 位或多位二进制数。

**向左或向右移 n 位**。

只有对有符号数的算术右移自动补符号位。

其他移位均自动补 0。

8.拼接复制运算符

拼接：格式 {操作数1，操作数2,...}

复制拼接：格式 {n{操作数1，操作数2，...}}

将多个操作数拼接起来；

将操作数复制 `n` 遍并拼接起来；

可以组合使用。

9.条件运算符

格式：表达式1？表达式2：表达式3

根据表达式1的值，决定运算结果：

- 如果表达式1值为1，则结果等于表达式2；
- 如果表达式1值为0，则结果等于表达式3；
- 如果表达式1值为x，则结果为x。

可以嵌套。